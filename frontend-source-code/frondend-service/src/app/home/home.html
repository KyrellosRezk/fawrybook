<div class="home-container" *ngIf="!loadingUser">
  <!-- Header -->
  <div class="home-header">
    <div class="user-info" *ngIf="user">
      <img [src]="user.logoPath || 'assets/default-avatar.png'" alt="Profile avatar" />
      <div class="user-name">{{ user.firstName }} {{ user.middleName }} {{ user.lastName }}</div>
    </div>
    <button class="signout-btn" (click)="signOut()">Sign Out</button>
  </div>

  <!-- Create Post -->
  <div class="create-post-container">
    <button class="create-post-btn" (click)="toggleCreatePost()">Create Post</button>

    <div class="create-post-modal" [class.show]="showCreatePost">
      <textarea [(ngModel)]="newPostContent" placeholder="What's on your mind?"></textarea>
      <input type="file" (change)="onFileSelected($event)" multiple />
      <div class="create-post-actions">
        <button (click)="submitPost()">Post</button>
        <button (click)="toggleCreatePost()">Cancel</button>
      </div>
    </div>
  </div>

  <div class="content">
    <!-- Posts Feed -->
    <div class="posts-feed">
      <div class="post-card" *ngFor="let post of postsPage.content">
        <div class="post-header">
          <img
            [src]="post.user.logoPath || 'assets/default-avatar.png'"
            class="post-user-avatar"
            alt="User"
          />
          <div>
            <div class="post-user-name">
              {{ post.user.firstName }} {{ post.user.middleName }} {{ post.user.lastName }}
            </div>
            <div class="post-meta">{{ post.id }}</div>
          </div>
        </div>

        <!-- Inline view / edit -->
        <div class="post-content" *ngIf="editingId !== post.id; else editTpl">
          {{ post.content }}
          <button class="link-btn" (click)="beginEdit(post)">Edit</button>
        </div>

        <!-- edit mode -->
        <ng-template #editTpl>
          <div class="post-edit">
            <textarea
              class="input"
              [(ngModel)]="editingContent"
              [maxlength]="1000"
              rows="5"
              (keydown.enter)="saveEdit()"
            ></textarea>
            <div class="hint">{{ editingContent?.length || 0 }}/1000</div>
            <div class="actions">
              <button class="btn" type="button" (click)="cancelEdit()" [disabled]="saving">
                Cancel
              </button>
              <button
                class="btn primary"
                type="button"
                (click)="saveEdit()"
                [disabled]="saving || !isValidContent(editingContent)"
              >
                {{ saving ? 'Saving…' : 'Save' }}
              </button>
            </div>
          </div>
        </ng-template>

        <div class="post-stats">
          <span>Likes: {{ post.likeCount }}</span>
          <span>Dislikes: {{ post.disLikeCount }}</span>
          <span>Comments: {{ post.commentsCount }}</span>
        </div>
      </div>

      <!-- Pagination footer -->
      <div class="pager">
        <button class="btn" (click)="prevPage()" [disabled]="!canPrev || loadingPosts">
          Previous
        </button>
        <span class="pager-info">
          Page {{ postsPage.page + 1 }} / {{ postsPage.totalPages }} • Total:
          {{ postsPage.totalElements }}
        </span>
        <button class="btn" (click)="nextPage()" [disabled]="!canNext || loadingPosts">Next</button>
      </div>

      <!-- Loading / End indicators -->
      <div *ngIf="loadingPosts" class="loading">Loading posts…</div>
      <div *ngIf="!loadingPosts && postsPage.totalPages > 0 && !canNext" class="loading">
        End of list
      </div>
    </div>

    <!-- Suggestions Sidebar -->
    <div class="suggestions-sidebar">
      <h3>People you may know</h3>
      <div class="suggestion-card" *ngFor="let suggestion of suggestionsPage.content">
        <img
          [src]="suggestion.logoPath || 'assets/default-avatar.png'"
          class="suggestion-avatar"
          alt="Suggestion"
        />
        <div class="suggestion-info">
          <div class="suggestion-name">
            {{ suggestion.firstName }} {{ suggestion.middleName }} {{ suggestion.lastName }}
          </div>
          <div class="suggestion-email">{{ suggestion.email }}</div>
        </div>
        <div class="suggestion-actions">
          <button (click)="follow(suggestion)">Follow</button>
          <button (click)="cancel(suggestion)">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</div>
